<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>comtypes COM interfaces</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date$
:Revision: $Revision$
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="comtypes-com-interfaces">
<h1 class="title">comtypes COM interfaces</h1>

<div class="contents topic">
<p class="topic-title first"><a id="contents" name="contents">Contents</a></p>
<ul class="simple">
<li><a class="reference" href="#defining-com-interfaces" id="id1" name="id1">Defining COM interfaces</a><ul>
<li><a class="reference" href="#the-methods-list" id="id2" name="id2">The <tt class="docutils literal"><span class="pre">_methods_</span></tt> list</a></li>
</ul>
</li>
<li><a class="reference" href="#sample-com-interfaces" id="id3" name="id3">Sample COM interfaces</a></li>
<li><a class="reference" href="#using-com-interfaces" id="id4" name="id4">using COM interfaces</a></li>
<li><a class="reference" href="#implementing-com-interfaces" id="id5" name="id5">implementing COM interfaces</a></li>
</ul>
</div>
<p>To use or implement a COM interface in <tt class="docutils literal"><span class="pre">comtypes</span></tt> a Python class
must be created.  Normally is is not needed to write this class
manually, <tt class="docutils literal"><span class="pre">comtypes.client.GetModule</span></tt> creates interfaces defined in
type libraries automatically.  However, an understanding of the
generated code is certainly useful.</p>
<p>A COM interface in <tt class="docutils literal"><span class="pre">comtypes</span></tt> is defined by creating a class.  The
class must derive from <tt class="docutils literal"><span class="pre">comtypes.IUnknown</span></tt> or a subclass of <tt class="docutils literal"><span class="pre">IUnknown</span></tt>.</p>
<p>COM interfaces in <tt class="docutils literal"><span class="pre">comtypes</span></tt> are abstract classes, they should never
be instantiated.</p>
<div class="section">
<h1><a class="toc-backref" href="#id1" id="defining-com-interfaces" name="defining-com-interfaces">Defining COM interfaces</a></h1>
<p>A COM interface class must define the following class attributes:</p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">_iid_</span></tt></p>
<blockquote>
a <tt class="docutils literal"><span class="pre">comtypes.GUID</span></tt> instance containing the <em>interface identifier</em> of the interface</blockquote>
<p><tt class="docutils literal"><span class="pre">_idlflags_</span></tt></p>
<blockquote>
(optional) a sequence containing IDL flags for the interface</blockquote>
<p><tt class="docutils literal"><span class="pre">_case_insensitive_</span></tt></p>
<blockquote>
(optional) If this is <tt class="docutils literal"><span class="pre">True</span></tt>, this interface supports case
insensitive attribute access.</blockquote>
<p><tt class="docutils literal"><span class="pre">_methods_</span></tt></p>
<blockquote>
a sequence describing the methods of this interface.  COM methods
of the superclass must not be listed, they are inherited
automatically.</blockquote>
</blockquote>
<div class="section">
<h2><a class="toc-backref" href="#id2" id="the-methods-list" name="the-methods-list">The <tt class="docutils literal"><span class="pre">_methods_</span></tt> list</a></h2>
<p>Methods are described in a way that somewhat looks like an IDL
definition of a COM interface.  Methods must be listed in VTable
order.</p>
<p>There are two functions that create a method definition: <tt class="docutils literal"><span class="pre">STDMETHOD</span></tt>
is the simple way, and <tt class="docutils literal"><span class="pre">COMMETHOD</span></tt> allows to specify more
information.</p>
<p><tt class="docutils literal"><span class="pre">comtypes.STDMETHOD(restype,</span> <span class="pre">methodname,</span> <span class="pre">argtypes=())</span></tt></p>
<blockquote>
<p>Calling <tt class="docutils literal"><span class="pre">STDMETHOD</span></tt> allows to specify the type of the COM method
return value.  Usually this is a <tt class="docutils literal"><span class="pre">comtypes.HRESULT</span></tt>, but other
return types are also possible.</p>
<p><tt class="docutils literal"><span class="pre">methodname</span></tt> is the name of the COM method.</p>
<p><tt class="docutils literal"><span class="pre">argtypes</span></tt> are the types of arguments that the COM method expects.</p>
</blockquote>
<p><tt class="docutils literal"><span class="pre">comtypes.COMMETHOD(idlflags,</span> <span class="pre">restype,</span> <span class="pre">methodname,</span> <span class="pre">*argspec)</span></tt></p>
<blockquote>
<p><tt class="docutils literal"><span class="pre">idlflags</span></tt> is a list of IDL flags for the method.  Possible values
include <tt class="docutils literal"><span class="pre">dispid(aNumber)</span></tt> and <tt class="docutils literal"><span class="pre">helpstring(HelpText)</span></tt>, as well as
<tt class="docutils literal"><span class="pre">&quot;propget&quot;</span></tt> for a property getter method, or <tt class="docutils literal"><span class="pre">&quot;proput&quot;</span></tt> for a
property setter method.</p>
<p><tt class="docutils literal"><span class="pre">restype</span></tt> and <tt class="docutils literal"><span class="pre">methodname</span></tt> are the same as above.</p>
<p><tt class="docutils literal"><span class="pre">argspec</span></tt> is a sequence of tuples, each item describing one
argument for the COM method, and must contain several items:</p>
<blockquote>
<ol class="arabic simple">
<li>a sequence of IDL flags: <tt class="docutils literal"><span class="pre">&quot;in&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;out&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;retval&quot;</span></tt>, <tt class="docutils literal"><span class="pre">&quot;lcid&quot;</span></tt>.</li>
<li>type of the argument.</li>
<li>argument name.</li>
</ol>
</blockquote>
</blockquote>
<!-- 4. XXX Are there more??? -->
<p>Since the <tt class="docutils literal"><span class="pre">IUnknown</span></tt> metaclass automatically creates Python methods
and properties that forward the call to the COM methods, there is
typically no need to write any Python methods for the interface class
(unless you want to override what the metaclass does).</p>
</div>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id3" id="sample-com-interfaces" name="sample-com-interfaces">Sample COM interfaces</a></h1>
<p>These are two simple COM interfaces. <tt class="docutils literal"><span class="pre">IProvideClassInfo</span></tt> only
contains one method <tt class="docutils literal"><span class="pre">GetClassInfo</span></tt> (in addition to the three methods
inherited from <tt class="docutils literal"><span class="pre">IUnknown</span></tt>).  <tt class="docutils literal"><span class="pre">IProvideClassInfo2</span></tt> inherits from
<tt class="docutils literal"><span class="pre">IProvideClassInfo</span></tt> and adds a <tt class="docutils literal"><span class="pre">GetGUID</span></tt> method.</p>
<p>IDL definition, slightly simplified (from <tt class="docutils literal"><span class="pre">OCIDL.IDL</span></tt>):</p>
<pre class="literal-block">
[
    object,
    uuid(B196B283-BAB4-101A-B69C-00AA00341D07),
    pointer_default(unique)
]
interface IProvideClassInfo : IUnknown
{
    HRESULT GetClassInfo(
                [out] ITypeInfo ** ppTI
            );
}
</pre>
<pre class="literal-block">
[
    object,
    uuid(A6BC3AC0-DBAA-11CE-9DE3-00AA004BB851),
    pointer_default(unique)
]
interface IProvideClassInfo2 : IProvideClassInfo
{
    HRESULT GetGUID(
                [in]  DWORD dwGuidKind,
                [out] GUID * pGUID
            );
}
</pre>
<p><tt class="docutils literal"><span class="pre">comtypes</span></tt> definition:</p>
<pre class="literal-block">
from ctypes import *
from comtypes import IUnknown, GUID, COMMETHOD
from comtypes.typeinfo import ITypeInfo

class IProvideClassInfo(IUnknown):
    _iid_ = GUID(&quot;{B196B283-BAB4-101A-B69C-00AA00341D07}&quot;)
    _methods_ = [
        # Returns the ITypeInfo interface for the object's coclass type information.
        COMMETHOD([], HRESULT, &quot;GetClassInfo&quot;,
                  ( ['out'],  POINTER(POINTER(ITypeInfo)), &quot;ppTI&quot; ) )
        ]
</pre>
<pre class="literal-block">
class IProvideClassInfo2(IProvideClassInfo):
    _iid_ = GUID(&quot;{A6BC3AC0-DBAA-11CE-9DE3-00AA004BB851}&quot;)
    _methods_ = [
        # Returns the GUID for the object's outgoing IID for its default event set.
        COMMETHOD([], HRESULT, &quot;GetGUID&quot;,
                  ( ['in'], DWORD, &quot;dwGuidKind&quot; ),
                  ( ['out', 'retval'], POINTER(GUID), &quot;pGUID&quot; ))
        ]
</pre>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id4" id="using-com-interfaces" name="using-com-interfaces">using COM interfaces</a></h1>
<p>As said above, comtypes interface classes are never instantiated, also
they are never used directly.  Instead, one uses instances of
<tt class="docutils literal"><span class="pre">POINTER(ISomeInterface)</span></tt> to call the methods on a COM object.</p>
<p>The <tt class="docutils literal"><span class="pre">IUnknown</span></tt> COM interface has <tt class="docutils literal"><span class="pre">AddRef()</span></tt>, <tt class="docutils literal"><span class="pre">Release()</span></tt>, and
<tt class="docutils literal"><span class="pre">QueryInterface()</span></tt> methods that you can call.  Since the COM internal
reference count is handled automatically by comtypes, there is no need
to call the first two methods.</p>
<p><tt class="docutils literal"><span class="pre">QueryInterface()</span></tt>, however, is the call that you need to ask a COM
object for other COM interfaces.  Since IUnknown is the base class of
<strong>all</strong> COM interfaces, it is available in every COM interface.</p>
<p>So, assuming you have a <tt class="docutils literal"><span class="pre">POINTER(IUnknown)</span></tt> instance, you can ask
for another interface by calling <tt class="docutils literal"><span class="pre">QueryInterface</span></tt> with the interface
you want to use.  For example:</p>
<blockquote>
# punk is a pointer to an IUnknown interface
pci = punk.QueryInterface(IProvideClassInfo)</blockquote>
<p>This call will either succeed and return a
<tt class="docutils literal"><span class="pre">POINTER(IProvideClassInfo)</span></tt> instance, or it will raise a
<tt class="docutils literal"><span class="pre">comtypes.COMError</span></tt> if the interface is not supported.  Assuming the
call succeeded, you can get the type information of the object by
calling:</p>
<blockquote>
# pci from above
ti = pci.GetClassInfo()</blockquote>
<p>Note that the <tt class="docutils literal"><span class="pre">GetClassInfo</span></tt> Python method has been created
automatically by the <tt class="docutils literal"><span class="pre">IUnknown</span></tt> metaclass.  Unless the call fails,
it will return a <tt class="docutils literal"><span class="pre">POINTER(ITypeInfo)</span></tt> instance.</p>
</div>
<div class="section">
<h1><a class="toc-backref" href="#id5" id="implementing-com-interfaces" name="implementing-com-interfaces">implementing COM interfaces</a></h1>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference" href="com_interfaces.txt">View document source</a>.
Generated on: 2006-12-01 19:58 UTC.

</div>
</body>
</html>
